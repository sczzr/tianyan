# 开发注意事项

## 编译问题

### 多项目文件冲突

当目录中存在多个 `.csproj` 或 `.sln` 文件时，`dotnet build` 命令会报错：

```
MSBUILD : error MSB1011: 此文件夹中包含多个项目或解决方案文件，请指定要使用的项目或解决方案文件。
```

**解决方法**：显式指定项目文件

```bash
dotnet build "FantasyMapGenerator.csproj"
```

### Export 属性路径参数错误

**错误写法**（会导致编译错误）：
```csharp
[Export("_menuPanel/_menuVBox/_newGameButton")]
private Button _newGameButton;
```

错误信息：`error CS1503: 参数 1: 无法从"string"转换为"Godot.PropertyHint"`

**正确写法**：
```csharp
// 方案1：在 _Ready 中使用 GetNode 获取节点
public override void _Ready()
{
	_newGameButton = GetNode<Button>("_menuPanel/_menuVBox/_newGameButton");
}

// 方案2：移除路径参数，手动在 Godot 编辑器中连接节点
[Export]
private Button _newGameButton;
```

## 节点获取最佳实践

### 使用 GetNode<T>() 获取节点

在 Godot C# 中，推荐使用 `GetNode<T>()` 方法在 `_Ready()` 中获取子节点：

```csharp
public override void _Ready()
{
	// 获取直接子节点
	_menuPanel = GetNode<PanelContainer>("_menuPanel");

	// 获取嵌套子节点
	_newGameButton = GetNode<Button>("_menuPanel/_menuVBox/_newGameButton");
	_loadGameButton = GetNode<Button>("_menuPanel/_menuVBox/_loadGameButton");
	_settingsButton = GetNode<Button>("_menuPanel/_menuVBox/_settingsButton");
	_quitButton = GetNode<Button>("_menuPanel/_menuVBox/_quitButton");

	SetupMenuItems();
}
```

### 完整示例

```csharp
public partial class MainMenu : Control
{
	[Export] private TextureRect _backgroundImage;
	[Export] private PanelContainer _menuPanel;
	[Export] private Label _versionLabel;

	private Button _newGameButton;
	private Button _loadGameButton;
	private Button _modManagerButton;
	private Button _settingsButton;
	private Button _quitButton;

	public override void _Ready()
	{
		_newGameButton = GetNode<Button>("_menuPanel/_menuVBox/_newGameButton");
		_loadGameButton = GetNode<Button>("_menuPanel/_menuVBox/_loadGameButton");
		_modManagerButton = GetNode<Button>("_menuPanel/_menuVBox/_modManagerButton");
		_settingsButton = GetNode<Button>("_menuPanel/_menuVBox/_settingsButton");
		_quitButton = GetNode<Button>("_menuPanel/_menuVBox/_quitButton");

		SetupMenuItems();
	}

	private void SetupMenuItems()
	{
		if (_newGameButton != null)
		{
			_newGameButton.Pressed += OnNewGamePressed;
		}
		// ... 其他按钮绑定
	}
}
```

## 调试技巧

### 检查节点是否成功获取

在 `_Ready()` 中打印节点信息，确认节点获取成功：

```csharp
public override void _Ready()
{
	_newGameButton = GetNode<Button>("_menuPanel/_menuVBox/_newGameButton");
	GD.Print($"_newGameButton: {_newGameButton}");

	if (_newGameButton == null)
	{
		GD.PrintErr("Failed to get _newGameButton node!");
		return;
	}
}
```

### 常见问题排查

| 问题 | 可能原因 | 解决方法 |
|------|----------|----------|
| 节点为 null | 路径错误或节点不存在 | 检查场景树结构，确认路径正确 |
| 类型转换错误 | 节点类型不匹配 | 确认 `GetNode<T>()` 中的类型与实际节点类型一致 |
| 编译错误 CS1503 | Export 使用了路径字符串 | 使用 `GetNode<T>()` 替代 |

## 场景结构示例

```
MainMenu (Control)
├── backgroundImage (TextureRect)
├── menuPanel (PanelContainer)
│   └── menuVBox (VBoxContainer)
│       ├── titleLabel (Label)
│       ├── Separator (HSeparator)
│       ├── newGameButton (Button)
│       ├── loadGameButton (Button)
│       ├── modManagerButton (Button)
│       ├── settingsButton (Button)
│       ├── quitButton (Button)
│       └── versionLabel (Label)

Settings (Control)
├── settingsPanel (PanelContainer)
│   └── settingsVBox (VBoxContainer)
│       ├── titleLabel (Label)
│       ├── Separator (HSeparator)
│       ├── volumeLabel (Label)
│       ├── volumeSlider (HSlider)
│       ├── musicLabel (Label)
│       ├── musicSlider (HSlider)
│       ├── Separator (HSeparator)
│       ├── languageLabel (Label)
│       ├── languageSelector (OptionButton)
│       ├── Separator (HSeparator)
│       ├── fullscreenCheck (CheckButton)
│       ├── Separator (HSeparator)
│       └── backButton (Button)

LoadGame (Control)
├── titleLabel (Label)
├── backButton (Button)
├── saveList (VBoxContainer)
│   ├── save001Button (Button)
│   ├── save002Button (Button)
│   └── autosaveButton (Button)

ModManager (Control)
├── titleLabel (Label)
├── backButton (Button)
└── modList (VBoxContainer)
	├── sampleModLabel (Label)
	└── sampleModCheck (CheckButton)

Game (Control)
├── mapView (Control)
└── menuButton (Button)
```

## 命名规范速查表

| 节点类型 | 命名模式 | 示例 |
|----------|----------|------|
| Control/Node | PascalCase | `MainMenu`, `GameHUD` |
| TextureRect | PascalCase | `BackgroundImage` |
| Button | PascalCase + Button | `NewGameButton`, `BackButton` |
| Label | PascalCase + Label | `TitleLabel`, `VersionLabel` |
| Panel | PascalCase + Panel | `MenuPanel`, `SettingsPanel` |
| Slider | PascalCase + Slider | `VolumeSlider`, `MusicSlider` |
| Container | PascalCase | `SaveList`, `ModList` |
| OptionButton | PascalCase | `LanguageSelector` |
| CheckButton | PascalCase | `FullscreenCheck`, `SampleModCheck` |
| HSeparator | Descriptive | `Separator` |

| 变量类型 | 命名规范 | 示例 |
|----------|----------|------|
| 私有字段 | `_` + camelCase | `_newGameButton`, `_titleLabel` |
| 公开属性 | PascalCase | `PlayerName`, `MaxHealth` |
| 局部变量 | camelCase | `currentHealth`, `itemCount` |
| 常量 | PascalCase | `DefaultCellCount`, `MinWaterLevel` |

## 相关文件

- `Scenes/UI/MainMenu.tscn` - 主菜单场景
- `Scripts/UI/MainMenu.cs` - 主菜单脚本
