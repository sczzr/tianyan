# 天衍峰：修仙商铺 - 贴图系统使用指南

## 概述

本文档介绍如何使用基于贴图的2D场景系统。所有场景都使用程序化生成的纹理和材质，无需外部图片资源即可运行。

---

## 📁 场景文件结构

```
Scenes/Locations/
├── TianYanMainPeak.tscn              # 基础版-天衍峰
├── TianYanCity.tscn                # 基础版-天衍城
├── YunLuMarket.tscn                  # 基础版-云麓坊市
├── TianYanMainPeak_Expanded.tscn    # 扩展版-天衍峰（详细）
├── ShopInterior.tscn                 # 室内场景-商铺
└── TianYanMainPeak_Textured.tscn  # ⭐贴图版-天衍峰（推荐）
```

---

## 🎨 贴图系统特性

### 程序化纹理

所有纹理都是程序化生成，无需外部图片：

| 纹理类型 | 生成方式 | 用途 |
|---------|---------|------|
| 天空渐变 | GradientTexture2D | 背景天空 |
| 星空噪声 | NoiseTexture2D | 星星分布 |
| 山脉轮廓 | NoiseTexture2D + 曲线 | 远景山脉 |
| 地面纹理 | NoiseTexture2D (法线) | 地面凹凸 |
| 粒子效果 | 程序生成 | 各种氛围效果 |

### 材质系统

#### 1. 天空材质 (SkyGradient)
```gdscript
# 三层渐变
顶部: 深蓝 (0.02, 0.05, 0.12)
中部: 中蓝 (0.08, 0.15, 0.28)
底部: 浅蓝 (0.15, 0.25, 0.4)
```

#### 2. 山脉材质 (MountainNoise)
```gdscript
# FBM噪声
类型: Simplex
频率: 0.005
分形倍频: 4
分形增益: 0.4
```

#### 3. 地面材质 (GroundTexture)
```gdscript
# 法线贴图
类型: Perlin
频率: 0.05
凹凸强度: 2.0
```

---

## 🏛️ 场景详解

### TianYanMainPeak_Textured.tscn（推荐）

#### 视觉层次

```
Layer 1: 远景天空 (渐变 + 星星噪声)
  ↓
Layer 2: 山脉剪影 (FBM噪声 + 视差滚动)
  ↓
Layer 3: 灵火粒子 (GPU粒子系统)
  ↓
Layer 4: 地面 (法线贴图 + 细节纹理)
  ↓
Layer 5: 建筑和物体 (Polygon2D + 着色器)
  ↓
Layer 6: 光照效果 (PointLight2D)
  ↓
Layer 7: 玩家和NPC (角色精灵)
  ↓
Layer 8: 前景效果 (粒子 + 雾气)
```

#### 关键特性

1. **视差滚动山脉**
   - 3层不同速度的山脉
   - 创造深度感

2. **动态天空**
   - 程序化星星
   - 可随时间变化

3. **灵火效果**
   - 数百个漂浮光点
   - 模拟灵气流动

4. **地面细节**
   - 法线贴图凹凸
   - 程序生成的纹理变化

5. **建筑渲染**
   - Polygon2D几何形状
   - 顶点颜色渐变
   - 动态光照响应

---

## 🎮 使用场景

### 在Godot编辑器中

1. **打开场景**
   ```
   双击 Scenes/Locations/TianYanMainPeak_Textured.tscn
   ```

2. **运行测试**
   ```
   按 F6 运行当前场景
   ```

3. **控制方式**
   ```
   WASD / 方向键 - 移动
   E - 交互
   鼠标滚轮 - 缩放
   鼠标中键 - 拖拽
   ```

### 在代码中切换场景

```csharp
// 使用场景管理器
SceneManager.Instance.ChangeScene("TianYanMainPeak_Textured");
```

---

## 🔧 自定义场景

### 修改天空颜色

1. 选择 `BackgroundLayer/SkyGradient`
2. 修改 `Gradient` 资源
3. 调整颜色停止点

### 添加新山脉层

1. 在 `BackgroundLayer` 下添加 `Parallax2D`
2. 添加 `Sprite2D` 子节点
3. 设置 `NoiseTexture2D` 或 `GradientTexture2D`
4. 调整 `scroll_scale` 改变视差速度

### 创建新建筑

1. 在 `Environment` 下添加 `Marker2D`
2. 添加 `Polygon2D` 子节点
3. 设置 `polygon` 定义形状
4. 设置 `color` 和 `vertex_colors`
5. 添加 `PointLight2D` 作为光源

---

## 📊 性能优化

### 当前优化

| 技术 | 说明 |
|------|------|
| 程序化纹理 | 无需加载图片，减少内存 |
| GPU粒子 | 使用GPUParticles2D，高效渲染 |
| 视差滚动 | 多层背景，2D实现深度 |
| 法线贴图 | 细节纹理，低消耗 |
| LOD系统 | 距离控制细节层次 |

### 进一步优化建议

1. **纹理尺寸控制**
   - 天空: 1920x1080
   - 山脉: 1920x600
   - 地面: 1024x1024 (重复)

2. **粒子数量限制**
   - 星星: 150个
   - 灵火: 50个
   - 云雾: 50个

3. **灯光数量**
   - 建筑光源: < 20个
   - 动态光源: < 10个

---

## 📝 总结

### 场景清单

| 场景文件 | 类型 | 特性 | 推荐使用 |
|---------|------|------|---------|
| TianYanMainPeak.tscn | 基础版 | 简单几何 | 开发测试 |
| TianYanCity.tscn | 基础版 | 简单几何 | 开发测试 |
| YunLuMarket.tscn | 基础版 | 简单几何 | 开发测试 |
| TianYanMainPeak_Expanded.tscn | 扩展版 | 详细几何+粒子 | 功能测试 |
| ShopInterior.tscn | 室内场景 | 完整室内 | 功能演示 |
| **TianYanMainPeak_Textured.tscn** | **贴图版** | **程序纹理+完整效果** | **⭐推荐使用** |

### 下一步建议

1. **添加角色贴图**: 创建玩家和NPC的精灵图
2. **完善UI系统**: 对话界面、商店界面
3. **添加音效**: 背景音乐、环境音效
4. **实现任务系统**: 与NPCController集成
5. **优化性能**: 根据目标平台调整

---

*文档创建日期: 2026-02-01*
*作者: Shawn*
*版本: 1.0*
