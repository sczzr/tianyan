### 小说世界书生成指南 - V3.1 终极兼容版

Codex AI 操作手册 - 精确到全字段

#### 一、核心目标与设计哲学

*   目标： 生成能够被SillyTavern等主流前端完美解析的、包含所有兼容性字段的专业级世界书 (`.json`) 文件。
*   设计哲学： 沿用“主题式聚合”原则，但确保每个生成的条目 (`entry`) 都包含范例中提供的全套字段，并赋予其合理的默认值。

#### 二、文件格式与结构

*   文件根结构: Codex导出的`.json`文件，其根对象直接就是一个包含`entries`的对象。这是当前生态中最通用的格式。
    ```json
    {
        "entries": { ... }
    }
    ```
*   `entries` 结构: `entries`的值是一个对象，其键为从`"0"`开始的连续数字字符串。

#### 三、终极设定条目 (`entry`) 对象模板

Codex AI在生成每一个设定条目时，必须使用以下包含所有字段的完整模板。

```json
"0": {
    // --- 核心内容与身份 ---
    "comment": "作者注释，如：世界背景",
    "key": ["关键词1", "关键词2"],
    "content": "结构化的设定内容",

    // --- 激活与优先级 ---
    "disable": false,
    "constant": false,
    "order": 100,
    "probability": 100,
    "useProbability": true,

    // --- 匹配与扫描行为 ---
    "keysecondary": [],
    "selective": false,
    "selectiveLogic": 0,
    "scanDepth": 10,
    "caseSensitive": false,
    "matchWholeWords": true, // 注意：对于中文，设为false可能更灵活
    "useGroupScoring": false,
    "matchPersonaDescription": false,
    "matchCharacterDescription": false,
    "matchCharacterPersonality": false,
    "matchCharacterDepthPrompt": false,
    "matchScenario": false,
    "matchCreatorNotes": false,

    // --- 位置与角色 ---
    "position": 0,
    "depth": 4,
    "role": null,
    
    // --- 高级激活控制 ---
    "triggers": [],
    "cooldown": 0,
    "delay": 0,
    "sticky": 0,

    // --- 递归与预算 ---
    "excludeRecursion": false,
    "preventRecursion": false,
    "delayUntilRecursion": false,
    "ignoreBudget": false,
    
    // --- 分组与自动化 ---
    "group": "",
    "groupOverride": false,
    "groupWeight": 100,
    "automationId": "",
    
    // --- 向量与内存 ---
    "vectorized": false,
    "addMemo": true,

    // --- UI与元数据 ---
    "uid": 0,
    "displayIndex": 0,
    "outletName": "",

    // --- 角色过滤 ---
    "characterFilter": {
        "isExclude": false,
        "names": [],
        "tags": []
    },

    // --- 兼容性扩展字段 ---
    "extensions": {
        // ... 此处镜像多个顶层字段以实现最大兼容 ...
    }
}
```

#### 四、全字段生成规则详解

Codex在填充上述模板时，应遵循以下规则：

##### A) 核心内容与身份
*   `comment` (String): 填入主题名称，如“大明皇室核心成员”。
*   `key` (Array of Strings): 收集主题下所有相关实体的名称和别称。
*   `content` (String): 使用结构化的“伪YAML”格式填充详细设定。
    *   规则:
        *   `content`内部必须采用一种高度结构化、易于解析的文本格式来组织信息。您提供的用例中的格式非常优秀，我们将其标准化。
        *   Codex 指导: 必须将作者的笔记整理成如下的“块状结构”：
            ```
            主题标题
            对该主题的整体介绍，可选

            人物详情: 人物A姓名
            name: 姓名
            aliases: 别称，以逗号分隔
            birth_death: 生卒年份
            position: 职位/身份
            personality_traits:
            - 性格特质1
            - 性格特质2
            physical_appearance: 外貌描述
            background: 背景故事
            achievements:
            - 主要成就1
            - 主要成就2
            relationships:
            - 与人物X的关系描述
            - 与人物Y的关系描述
            quotes:
            - 代表性语录1
            notes: 给AI看的额外注释或当前状态

            人物详情: 人物B姓名
            ... (重复以上结构) ...
            ```
        *   重要 这种“伪YAML”或“Markdown列表”的格式，对于现代大型语言模型来说极易理解。AI能够轻松地在这一大段`content`中定位到特定人物（如“朱棣”）并提取其相关信息（如`personality_traits`和`relationships`）。


##### B) 激活与优先级
*   `disable` (Boolean): `false` = 启用。
*   `constant` (Boolean): `true` 用于“世界背景”等全局设定，其他默认为 `false`。
*   `order` (Number): 根据信息重要性设置（数字越小越优先）。
*   `probability` (Number): 默认为 `100`。
*   `useProbability` (Boolean): 默认为 `true`。

##### C) 匹配与扫描行为
*   `keysecondary` (Array): 默认为空数组 `[]`。
*   `selective` (Boolean): 默认为 `false`。
*   `selectiveLogic` (Number): 默认为 `0`。
*   `scanDepth` (Number): 推荐默认值为 `10`。
*   `caseSensitive` (Boolean): 默认为 `false` (不区分大小写)。
*   `matchWholeWords` (Boolean): 默认为 `true`。Codex可提供选项：对于中文等语言，设为`false`（部分匹配）通常效果更好。
*   所有 `match...` 字段: 默认为 `false`，因为世界书是通用的，不应默认绑定到角色卡的特定部分。

##### D) 位置与角色
*   `position` (Number): 默认为 `0`。
*   `depth` (Number): 推荐默认值为 `4`。
*   `role` (null/String): 默认为 `null`。

##### E) 其他字段
*   所有其他在模板中出现但未特别说明的字段（如`triggers`, `cooldown`, `sticky`, `group`, `vectorized`, `uid`等），均应按照模板中的默认值（通常是`0`, `false`, `null`或空字符串/数组）进行填充。这些是高级功能或UI保留字段，设置安全的默认值即可。

##### F) `extensions` 对象 (兼容性的关键)

*   规则: 这是为了兼容不同版本前端的镜像/备份字段。Codex必须生成此对象。
*   内容: `extensions` 对象内部的字段和值，应精确复制顶层中对应的字段和值。
*   Codex 指导: 在生成完所有顶层字段后，复制以下字段及其值到`extensions`对象内部：
    *   `selectiveLogic`, `position`, `depth`, `role`, `match_whole_words`, `probability`, `useProbability`, `sticky`, `cooldown`, `delay`, `exclude_recursion`, `prevent_recursion`, `delay_until_recursion`, `group`, `group_override`, `group_weight`, `use_group_scoring`, `scan_depth`, `case_sensitive`, `automation_id`, `vectorized`。

    最终生成的`extensions`对象示例：
    ```json
    "extensions": {
        "selectiveLogic": 0,
        "position": 0,
        "depth": 4,
        "role": 0, // 注意：SillyTavern中 role 在 extensions 里常为数字0
        "match_whole_words": true,
        "probability": 100,
        "useProbability": true,
        "sticky": 0,
        "cooldown": 0,
        "delay": 0,
        "exclude_recursion": false,
        "prevent_recursion": false,
        "delay_until_recursion": false,
        "group": "",
        "group_override": false,
        "group_weight": 100,
        "use_group_scoring": false,
        "scan_depth": 10, // 确保与顶层 scanDepth 一致
        "case_sensitive": false,
        "automation_id": "",
        "vectorized": false
    }
    ```