# 天篆系统技术实现 (v1.0)

本篇文档整合了游戏中【天篆】这一核心力量体系的技术实现，包括其数据模型、管理系统、组合逻辑与效果解析，旨在构建一个功能强大、可拓展且充满深度的【天篆】驱动法术系统。

---

## 1. 核心概念与分级体系

【天篆】是苍玄界法则的具现化符号，是修士感悟天地大道，并将其力量体系化的核心。其分级严谨，从宏观到微观，层层递进。

### 1.1 法则母体 (Mother Laws)
将宇宙法则划分为三大根源，是万物之纲，九道之祖。
- **【存续】**: 物质与时空系统 (坤·固, 乾·空, 宙·序)
- **【流转】**: 能量系统 (元素, 生机, 死寂)
- **【心意】**: 信息与意识系统 (神·念, 幻·信, 缘·运)

### 1.2 原道 (Primal Dao)
三大母法显化于世的九种至德要道，每种原道下辖多个道枢。

### 1.3 道枢 (Dao Hubs)
更具体的法则分支，如【万象道枢】（元素）掌管金木水火土风雷光暗等，每个道枢下包含数十个核心天篆。

### 1.4 天篆 (Heavenly Seals)
构成所有法术、阵法、神通的基本符号，形似古字，蕴含法则。每个天篆代表一个基础概念或功能。

## 2. 天篆数据模型 (`TianZhuanData.cs`)

所有【天篆】的核心数据载体，通过JSON文件配置，便于管理与Mod拓展。

```csharp
public class TianZhuanData
{
    public string ID { get; set; } // 天篆唯一标识符, e.g., "Fire"
    public string Name { get; set; } // 天篆名称, e.g., "火"
    public TianZhuanRank Rank { get; set; } // 等级: Core, High-tier (核心, 高阶)
    public string AffiliatedDaoHub { get; set; } // 所属道枢, e.g., "万象道枢"
    public List<string> FunctionCategories { get; set; } // 功能类别, e.g., ["元素", "攻击", "爆发"]
    public string DiscoveryEra { get; set; } // 发现时代
    public string Discoverer { get; set; } // 发现者
    public string XuanxueKoujue { get; set; } // 玄学口诀
    public TianZhuanForm FormDescription { get; set; } // 形态描述
    public LinXunAnnotation LinXunAnnotation { get; set; } // 林洵注释 (科学解释)
    public string DetailedFunction { get; set; } // 功能详述
    public List<DerivedForm> DerivedForms { get; set; } // 法则交织下的形态衍化
    public Dictionary<string, string> TechnicalParameters { get; set; } // 技术参数
    public CultivationRestriction CultivationRestrictions { get; set; } // 修习与限制
    public DaoHubRelationship DaoHubRelationships { get; set; } // 道枢关系网络
    public string HistoricalSignificance { get; set; } // 历史发展意义
    public List<ApplicationExample> ApplicationExamples { get; set; } // 应用实例
}

public class TianZhuanForm
{
    public string ThreeDProjection { get; set; } // 三维投影
    public string TwoDTopology { get; set; } // 二维拓扑
}

public class LinXunAnnotation
{
    public string PhysicalEssence { get; set; } // 物理本质
    public string Mechanism { get; set; } // 作用机制
    public string MathematicalExpression { get; set; } // 数学表达
    public string ApplicationPrinciple { get; set; } // 应用原理
}

public class DerivedForm
{
    public string Context { get; set; } // 法则交织情境, e.g., "当与【客场道枢：万象道枢·光】交织时"
    public string FormName { get; set; } // 衍化形态名称, e.g., "太阳真火/净化之炎"
    public string LawInterpretation { get; set; } // 法则释义
    public string CombatApplication { get; set; } // 实战应用
}

public class CultivationRestriction
{
    public string CultivationRealm { get; set; } // 修为境界
    public string DaoHubUnderstanding { get; set; } // 道枢理解
    public string SoulRequirements { get; set; } // 神魂要求
    public string UsageRestrictions { get; set; } // 使用限制
    public string Countermeasures { get; set; } // 反制手段
}

public class DaoHubRelationship
{
    public string UpstreamDaoHub { get; set; } // 上游道枢
    public List<string> CollaborativeDaoHubs { get; set; } // 协同道枢
    public List<string> CompatibleTianZhuans { get; set; } // 兼容天篆
}

public class ApplicationExample
{
    public string StandardApplication { get; set; }
    public string CombinationApplication { get; set; }
    public string LinXunModifiedApplication { get; set; }
}

public enum TianZhuanRank
{
    Core, // 核心天篆
    HighTier // 高阶天篆
    // ... 可以根据需要添加更多等级
}
```

## 3. 天篆管理系统 (`TianZhuanManager.cs`)

负责所有【天篆】的加载、存储、检索、组合与效果计算。作为游戏核心系统之一，需在`GameManager`启动时初始化。

### 3.1 数据加载与存储
- **职责**:
  - 游戏启动时，从外部JSON文件（e.g., `Config/TianZhuans/*.json`）加载所有【天篆】定义。
  - 支持Mod加载机制，允许Mod作者新增或覆写【天篆】数据。
  - 提供按ID、名称、所属道枢、功能类别等条件检索【天篆】的接口。
- **数据结构**: `Dictionary<string, TianZhuanData> AllTianZhuans`，以天篆ID为Key。

### 3.2 天篆组合与效果计算
- **核心逻辑**:
  - **单天篆激活**: 当玩家或NPC激活单个【天篆】时，解析其`DetailedFunction`和`TechnicalParameters`，直接应用其效果。
  - **组合天篆**: 
    - 接收一个`List<string> tianZhuanIDs`（表示组合序列）和一个`Dictionary<string, object> parameters`（运行时参数，如目标、强度等）。
    - 依据`DerivedForms`（法则交织下的形态衍化）中的定义，匹配最合适的组合效果。
    - 引入**“道纹音律和谐理论”**:
      - `CalculateHarmony(List<TianZhuanData> combination)`: 评估组合天篆的“和谐度”。高和谐度可增强效果，低和谐度可能导致效果减弱、不稳定，甚至法则冲突反噬。
      - `DaoPatternResonanceTable`: 内部维护一个天篆间的谐振频率表，用于计算和谐度。
    - 效果计算需要考虑：参与天篆的品质、数量、组合顺序、施法者修为、神念谐振以及当前环境法则。
- **接口**:
  - `ActivateTianZhuan(string tianZhuanID, object target, object caster)`: 激活单个天篆。
  - `CombineTianZhuans(List<string> tianZhuanIDs, object target, object caster, Dictionary<string, object> runtimeParams)`: 激活组合天篆。
  - `PredictEffect(List<string> tianZhuanIDs, object caster, Dictionary<string, object> potentialParams)`: 预测组合天篆的效果与成功率 (集成至`CreationManager`的“衍化创法”系统)。

## 4. 与其他系统的集成

### 4.1 角色系统 (`CharacterData.cs`)
- **天赋与感悟**:
  - `Dictionary<string, int> LearnedTianZhuans`: 角色已领悟的天篆及其熟练度。
  - `float Comprehension`: 影响领悟新天篆的速度与组合天篆的和谐度。
  - `float MentalResilience`: 影响抵抗【心猿道枢】天篆负面效果的能力。
- **技能树/天篆系统 (`SkillManager.cs`)**:
  - 管理玩家可学习的天篆列表。
  - 随着修为提升和特定任务完成，解锁新的天篆或天枢权限。

### 4.2 创造系统 (`CraftingManager.cs` & `CreationManager.cs`)
- **炼器与炼丹**:
  - 炼器时，【天篆】可作为“符文”刻印在法宝上，赋予其特殊属性（通过`AffixSystem`集成）。
  - 炼丹时，【天篆】可用于精确控制药材反应、提升药性，甚至在丹药中封印法则效果。
- **衍化创法**:
  - 玩家在“衍化台”上组合材料和【天篆】序列。
  - `CreationManager` 调用`TianZhuanManager.PredictEffect`来评估组合的逻辑性和效果，决定是否调用LLM生成新的配方和物品。

### 4.3 战斗系统 (`CombatManager.cs`)
- **法术与神通**:
  - 所有法术和神通的底层实现，都是通过组合一个或多个【天篆】来完成。
  - 战斗中，动态解析天篆组合，计算伤害、控制效果、增益/减益。
- **状态管理**:
  - 【天篆】产生的各种Buff/Debuff（如加速、减速、中毒、虚弱）通过`ActiveEffect`添加到目标身上。

## 5. 用户界面 (UI)

### 5.1 天篆图谱界面 (`TianZhuanAtlasUI.tscn`)
- **功能**:
  - 展示所有已发现和未发现的【天篆】及其详细信息。
  - 提供搜索、筛选功能。
  - 可视化【天篆】的`DerivedForms`和`DaoHubRelationships`，以“节点图”或“思维导图”形式展示其组合与联系。
  - 玩家可以尝试模拟组合不同的【天篆】，预览其效果（低精度模拟）。

### 5.2 法术/神通编辑界面 (`SpellEditorUI.tscn`)
- **功能**:
  - 玩家在此界面拖拽组合已学习的【天篆】，设计自己的法术或神通。
  - 实时反馈组合的“和谐度”、灵力消耗、威力预测等关键数据。
  - 玩家可保存自创法术的“天篆序列”为新的法术蓝图。

## 6. 未来拓展方向

- **动态天篆**: 引入“活化”天篆的概念，允许天篆在战斗中根据环境动态调整自身参数。
- **天篆变异与进化**: 特定条件下，现有天篆可与其他法则融合，诞生全新的、更强大的天篆（需与`CreationManager`深度集成）。
- **神纹领域**: 高阶修士可将自身所学【天篆】固化为“神纹领域”，在领域内获得天篆效果加成。